# Улучшения геометрии линий соединений в AlgoMap

## Обзор изменений

Добавлен функционал управления геометрией соединительных линий (edges) в визуальном редакторе AlgoMap, который решает проблему пересечения линий с блоками и улучшает читаемость блок-схем.

## Реализованный функционал

### 1. Базовое улучшение (✅ Реализовано)

- **Тип линий по умолчанию**: изменен с `default` на `smoothstep`
  - Автоматический обход блоков с помощью сглаженных ступенек
  - Применяется ко всем новым соединениям
  - Существующие схемы автоматически мигрируют на новый тип при загрузке

- **Улучшенный стиль линий**:
  - Цвет: `#94a3b8` (серо-синий)
  - Толщина: 2px
  - Стрелка на конце линии (`arrowclosed`)
  - Hover эффект: цвет меняется на `#3b82f6`, толщина на 3px
  - Плавные анимации переходов

### 2. Интерактивное управление (✅ Реализовано)

- **Панель настройки линий** (`EdgeConfigPanel`)
  - Открывается при клике на линию соединения
  - Позволяет выбрать один из 4 типов линий:
    - **Smooth Step** - сглаженные ступеньки (рекомендуется)
    - **Step** - прямые углы
    - **Straight** - прямая линия
    - **Bezier** - кривая Безье
  - Переключатель анимации движения
  - Информация о соединении (ID, источник, цель)

- **UI элементы**:
  - Радио-кнопки для выбора типа линии
  - Описание каждого типа
  - Чекбокс для включения анимации
  - Советы по использованию
  - Кнопка закрытия панели

### 3. Визуальные улучшения

- Линии подсвечиваются при наведении курсора
- Выбранная линия визуально выделяется
- Плавные CSS переходы для всех интерактивных элементов
- Улучшенная читаемость схем за счет правильного выбора цветов

## Измененные файлы

### Новые файлы:

1. **`front-end/src/components/EdgeConfigPanel.jsx`** (142 строки)
   - Компонент панели настройки линий
   - Управление типом и анимацией линий
   - Отображение информации о соединении

2. **`front-end/src/styles/EdgeConfigPanel.css`** (179 строк)
   - Стили для панели настройки линий
   - Стили для типов линий и форм выбора
   - Адаптивная верстка

### Измененные файлы:

1. **`front-end/src/pages/EditorPage.jsx`**
   - Добавлено состояние `selectedEdge` для выбранной линии
   - Добавлены обработчики:
     - `onConnect` - создание линий с настройками по умолчанию
     - `onEdgeClick` - выбор линии для настройки
     - `onEdgeConfigUpdate` - обновление настроек линии
     - `onEdgesDelete` - удаление линий
   - Применение улучшенных стилей к загруженным линиям
   - Интеграция `EdgeConfigPanel` в интерфейс

2. **`front-end/src/styles/Editor.css`**
   - Добавлены стили для линий соединений (`.react-flow__edge-path`)
   - Стили для hover эффектов
   - Стили для выбранных линий
   - Стили для стрелок (`react-flow__arrowhead`)

3. **`front-end/README.md`**
   - Добавлен раздел "Работа с линиями соединений"
   - Описание типов линий
   - Инструкции по использованию
   - Документация визуальных эффектов

## Как использовать

### Создание соединения

1. Перетащите курсор от выходной точки одного блока к входной точке другого
2. Линия автоматически создастся с типом **Smooth Step**
3. Линия будет обходить блоки на своем пути

### Изменение типа линии

1. Кликните на линию между блоками
2. В правой панели откроется "Настройки линии"
3. Выберите нужный тип линии (Smooth Step / Step / Straight / Bezier)
4. При необходимости включите анимацию движения
5. Сохраните схему (кнопка "Сохранить" в шапке)

### Удаление линии

1. Выберите линию кликом
2. Нажмите клавишу `Delete`

## Технические детали

### React Flow настройки

```javascript
// Дефолтные параметры для новых линий
const newEdge = {
  ...params,
  type: 'smoothstep',
  animated: false,
  style: {
    stroke: '#94a3b8',
    strokeWidth: 2,
  },
  markerEnd: {
    type: 'arrowclosed',
    color: '#94a3b8',
  },
};
```

### Миграция существующих схем

При загрузке существующих схем автоматически применяются улучшенные стили:

```javascript
const enhancedEdges = currentSchema.definition.edges.map((edge) => ({
  ...edge,
  type: edge.type && edge.type !== 'default' ? edge.type : 'smoothstep',
  style: { stroke: '#94a3b8', strokeWidth: 2, ...edge.style },
  markerEnd: edge.markerEnd || { type: 'arrowclosed', color: '#94a3b8' },
}));
```

### Совместимость

- ✅ Полная совместимость с существующими схемами
- ✅ Старые схемы автоматически получают улучшенные стили
- ✅ Пользовательские настройки линий сохраняются
- ✅ Работает со всеми типами блоков (включая Condition Node)

## Преимущества

1. **Улучшенная читаемость** - линии не пересекают блоки
2. **Профессиональный вид** - схемы выглядят аккуратно и понятно
3. **Гибкость** - пользователь может выбрать подходящий тип линии
4. **Удобство** - интуитивный интерфейс настройки
5. **Совместимость** - работает с существующими схемами

## Рекомендации по использованию

### Когда использовать разные типы линий:

- **Smooth Step** (по умолчанию)
  - Для большинства схем
  - Когда блоки расположены близко друг к другу
  - Для сложных схем с множеством соединений

- **Step**
  - Для строгих прямоугольных схем
  - Когда важна геометрическая точность
  - Для технических диаграмм

- **Straight**
  - Для простых линейных потоков
  - Когда блоки выстроены в ряд
  - Для минималистичных схем

- **Bezier**
  - Для классического вида блок-схем
  - Когда нужны плавные кривые
  - Для презентационных схем

### Анимация движения

Включайте анимацию когда:
- Нужно показать направление потока данных
- Для демонстрации активных соединений
- В режиме отладки/выполнения схемы

## Возможные улучшения (будущие версии)

### Продвинутый уровень (не реализовано):
- Кастомные edges с промежуточными точками (waypoints)
- Возможность добавлять/удалять/перетаскивать промежуточные точки
- Ручная корректировка траектории линии
- Метки на линиях (labels)
- Условное оформление линий (разные цвета для разных условий)

## Тестирование

### Проверено:

- ✅ Создание новых соединений
- ✅ Загрузка существующих схем
- ✅ Переключение типов линий
- ✅ Включение/выключение анимации
- ✅ Удаление линий
- ✅ Сохранение схемы с новыми настройками
- ✅ Hover эффекты
- ✅ Выделение при клике
- ✅ Сборка проекта (npm run build)

### Браузеры:

Тестируется в:
- Chrome/Edge (рекомендуется)
- Firefox
- Safari

## Заключение

Реализован полный функционал управления геометрией линий в AlgoMap. Базовое улучшение решает проблему пересечения линий с блоками, а интерактивное управление дает пользователю гибкость в настройке внешнего вида схем.

Все требования из задачи выполнены:
- ✅ Базовое улучшение
- ✅ Интерактивное управление
- ✅ Сохранение конфигурации
- ✅ Совместимость с существующими схемами
